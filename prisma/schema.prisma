generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  TEACHER
  ECOLE
  ADMIN
  GHOST
}

enum EventType {
  course_start
  join
  speech
  finish
  course_stop
}

model User {
  id          String       @id @default(uuid())
  email       String       @unique
  password    String
  name        String?
  role        Role
  exp         Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  enrollments Enrollment[]
  courses     Course[]     @relation("TeacherCourses")
}

model Course {
  id          String          @id @default(uuid())
  title       String
  teacherId   String
  teacher     User            @relation("TeacherCourses", fields: [teacherId], references: [id])
  enrollments Enrollment[]
  sessions    CourseSession[]
}

model Enrollment {
  id       String @id @default(uuid())
  userId   String
  courseId String
  user     User   @relation(fields: [userId], references: [id])
  course   Course @relation(fields: [courseId], references: [id])

  @@unique([userId, courseId])
}

model CourseSession {
  id        String         @id @default(uuid())
  courseId  String
  course    Course         @relation(fields: [courseId], references: [id])
  startedAt DateTime
  endedAt   DateTime?
  events    SessionEvent[]
}

model SessionEvent {
  id        String        @id @default(uuid())
  sessionId String
  session   CourseSession @relation(fields: [sessionId], references: [id])
  type      EventType
  userId    String?
  at        DateTime      @default(now())
}
